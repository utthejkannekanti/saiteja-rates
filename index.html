<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sai Teja Jewellery - Rate Card</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#d4af37">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Serif+Telugu:wght@400;700&display=swap" rel="stylesheet">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Georgia', serif;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        /* CONTROLS (Input Area) */
        .controls {
            background: white;
            padding: 20px;
            width: 100%;
            max-width: 380px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-top: 5px solid #d4af37;
        }
        
        .status-bar {
            font-family: 'Inter', sans-serif; font-size: 11px; color: #666;
            background: #f0f0f0; padding: 10px; border-radius: 6px;
            margin-bottom: 15px; display: flex; flex-direction: column; gap: 6px;
        }
        
        .status-item { display: flex; align-items: center; gap: 8px; }
        .status-dot { height: 8px; width: 8px; background-color: #ccc; border-radius: 50%; display: inline-block; }
        .status-dot.loading { background-color: #ffa500; animation: blink 1s infinite; }
        .status-dot.success { background-color: #25D366; }
        .status-dot.error { background-color: #ff4444; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600; color: #555; margin-bottom: 4px; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; outline: none; }

        .actions { display: flex; gap: 8px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-family: 'Inter', sans-serif; font-weight: 600; color: white; }
        .btn-print { background-color: #333; }
        .btn-share { background-color: #25D366; }
        .btn-reset { background-color: #d9534f; flex: 0 0 auto; }

        /* THE CARD - FIXED SIZE */
        .card-wrapper {
            width: 380px; /* Force exact width for consistency */
            margin: 0 auto;
        }

        .rate-card {
            position: relative;
            width: 380px; /* Fixed width for sharing */
            background-color: #fff3e0;
            border: 4px solid #d4af37;
            padding: 20px;
            text-align: center;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgjxlHBUYQ9WBrZajYmGgGod1GTx6MfO_z_TygJkSg1SpHV9-WlOwBN4T37HidH5q0-Wu28ATC5oxfdqWeiXC7NNJPxzdW5UoiJrbNkF5gm3-m3CqQLG0Ogy0TXgutsYrgXdfYFBnTojC_Od_nsx3X5zWEMhj_Jtqx9mHCW1myrpxbmPY56hTt5SUxNe7V8/s1600/â€”Pngtreeâ€”hindu%20god%20vishwakarma%20seated%20on_22565292.png');
            background-position: center; background-size: 85%; background-repeat: no-repeat;
            opacity: 0.12; z-index: 0;
        }

        .card-content { position: relative; z-index: 1; }
        .shop-name { color: #b00000; font-size: 20px; font-weight: bold; margin-bottom: 2px; }
        .shop-place { font-size: 14px; color: #333; font-weight: bold; margin-bottom: 5px; }
        .shop-contact { font-size: 13px; color: #000; font-weight: bold; margin-bottom: 15px; }

        .date-section { margin-bottom: 15px; border-top: 1px dashed #d4af37; border-bottom: 1px dashed #d4af37; padding: 6px 0; }
        #dateDisplay { font-size: 14px; font-weight: bold; color: #444; }

        table { width: 100%; border-collapse: collapse; background: rgba(255, 255, 255, 0.7); border: 1px solid #d4af37; }
        th { background-color: #d4af37; color: white; padding: 8px; font-size: 13px; font-family: 'Noto Serif Telugu', serif; }
        td { padding: 12px 8px; border: 1px solid #d4af37; font-size: 16px; vertical-align: middle; }
        td:first-child { font-family: 'Noto Serif Telugu', serif; font-weight: bold; color: #5a2d0c; text-align: left; }
        .metal-sub { font-size: 11px; color: #666; font-family: 'Inter', sans-serif; display: block; }
        .rate-value { font-family: 'Inter', sans-serif; font-weight: 700; color: #000; font-size: 22px; }

        @media print {
            .controls, .actions { display: none !important; }
            body { padding: 0; background: white; }
            .rate-card { box-shadow: none; border: 4px solid #d4af37 !important; }
        }
    </style>
</head>
<body>

    <div class="controls" data-html2canvas-ignore="true">
        <div class="status-bar">
            <div class="status-item" id="goldStatus"><span class="status-dot loading"></span> <span id="goldText">Live Gold...</span></div>
            <div class="status-item" id="silverStatus"><span class="status-dot loading"></span> <span id="silverText">Live Silver...</span></div>
        </div>
        <div class="input-group">
            <label>Gold 24K / 10g</label>
            <input type="number" id="inputGold" oninput="manualUpdate()">
        </div>
        <div class="input-group">
            <label>Silver / 1kg</label>
            <input type="number" id="inputSilver" oninput="manualUpdate()">
        </div>
        <div class="actions">
            <button class="btn btn-print" onclick="window.print()">PDF</button>
            <button class="btn btn-share" onclick="shareCard()">Share Image</button>
            <button class="btn btn-reset" onclick="resetData()">Reset</button>
        </div>
    </div>

    <div class="card-wrapper">
        <div class="rate-card" id="cardToCapture">
            <div class="bg-layer"></div>
            <div class="card-content">
                <div class="shop-name">SAI TEJA JEWELLERY WORKS</div>
                <div class="shop-place">Kamalanagar, Vanasthalipuram</div>
                <div class="shop-contact">ðŸ“± 98661 21314 | 95531 21314</div>
                <div class="date-section">
                    <span id="dateDisplay"></span>
                </div>
                <table>
                    <thead>
                        <tr><th>Metal / à°²à±‹à°¹à°‚</th><th>Rate / à°§à°° (â‚¹)</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>GOLD (24K)<br><span class="metal-sub">à°¬à°‚à°—à°¾à°°à°‚ (10g)</span></td>
                            <td class="rate-value" id="dispGold">-</td>
                        </tr>
                        <tr>
                            <td>SILVER<br><span class="metal-sub">à°µà±†à°‚à°¡à°¿ (1 kg)</span></td>
                            <td class="rate-value" id="dispSilver">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function init() {
            const now = new Date();
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' };
            document.getElementById('dateDisplay').innerText = now.toLocaleDateString('en-IN', options);

            const sg = localStorage.getItem('saiTejaGold');
            const ss = localStorage.getItem('saiTejaSilver');
            if (sg) document.getElementById('inputGold').value = sg;
            if (ss) document.getElementById('inputSilver').value = ss;

            updateVisuals();
            // Add your fetch logic here if needed
        }

        function formatINR(n) { return n ? "â‚¹ " + new Intl.NumberFormat('en-IN').format(n) : "-"; }

        function updateVisuals() {
            document.getElementById('dispGold').innerText = formatINR(document.getElementById('inputGold').value);
            document.getElementById('dispSilver').innerText = formatINR(document.getElementById('inputSilver').value);
        }

        function manualUpdate() {
            updateVisuals();
            localStorage.setItem('saiTejaGold', document.getElementById('inputGold').value);
            localStorage.setItem('saiTejaSilver', document.getElementById('inputSilver').value);
        }

        function resetData() {
            if(confirm("Clear data?")) { localStorage.clear(); location.reload(); }
        }

        async function shareCard() {
            const card = document.getElementById('cardToCapture');
            const btn = document.querySelector('.btn-share');
            btn.innerText = "Generating...";

            try {
                const canvas = await html2canvas(card, {
                    width: 380,
                    height: card.offsetHeight,
                    scale: 3, // High quality
                    useCORS: true,
                    backgroundColor: "#fff3e0"
                });

                canvas.toBlob(async (blob) => {
                    const file = new File([blob], "SaiTeja_Rates.png", { type: "image/png" });
                    if (navigator.share && navigator.canShare({ files: [file] })) {
                        await navigator.share({ files: [file], title: 'Gold Rates' });
                    } else {
                        const link = document.createElement('a');
                        link.href = canvas.toDataURL();
                        link.download = "SaiTeja_Rates.png";
                        link.click();
                    }
                    btn.innerText = "Share Image";
                });
            } catch (err) { alert("Error sharing."); btn.innerText = "Share Image"; }
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
        window.onload = init;
    </script>
</body>
</html>
